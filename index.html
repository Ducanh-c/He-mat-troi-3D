<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>H·ªá M·∫∑t Tr·ªùi 3D</title>
    <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background: #000000;
          overflow: hidden;
      }

      #canvas-container {
          width: 100vw;
          height: 100vh;
          position: relative;
      }

      .info {
          position: absolute;
          top: 30px;
          left: 50%;
          transform: translateX(-50%);
          text-align: center;
          color: white;
          z-index: 10;
          pointer-events: none;
      }

      h1 {
          font-size: 2.5em;
          font-weight: 700;
          margin-bottom: 10px;
          text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
          letter-spacing: 3px;
      }

      .subtitle {
          font-size: 1.1em;
          opacity: 0.8;
          letter-spacing: 2px;
      }

      .controls {
          position: absolute;
          bottom: 30px;
          left: 50%;
          transform: translateX(-50%);
          color: white;
          font-size: 0.9em;
          opacity: 0.7;
          text-align: center;
          z-index: 10;
      }

      .brightness-control {
          position: absolute;
          top: 30px;
          right: 30px;
          z-index: 10;
      }

      .brightness-btn {
          background: rgba(255, 255, 255, 0.1);
          border: 2px solid rgba(255, 255, 255, 0.3);
          color: white;
          padding: 12px 20px;
          font-size: 1.2em;
          border-radius: 50px;
          cursor: pointer;
          transition: all 0.3s ease;
          backdrop-filter: blur(10px);
      }

      .brightness-btn:hover {
          background: rgba(255, 255, 255, 0.2);
          border-color: rgba(255, 255, 255, 0.5);
          transform: scale(1.05);
      }

      #open-quiz-btn {
          transition: all 0.3s cubic-bezier(.4,2,.3,1);
      }
      #open-quiz-btn:hover {
          background: #fff700;
          color: #222;
          box-shadow: 0 0 32px 8px #ffe066, 0 0 60px 16px #ffd700;
          transform: scale(1.13) rotate(-2deg);
          border: 2px solid #ffe066;
          filter: brightness(1.15) drop-shadow(0 0 12px #fff700);
      }

      .brightness-btn:active {
          transform: scale(0.95);
      }

      .active-btn {
          box-shadow: 0 0 20px 5px rgba(255,255,255,0.5), 0 0 40px 10px rgba(255,255,255,0.2);
          animation: glowPulse 1.2s infinite alternate;
      }

      @keyframes glowPulse {
          0% { box-shadow: 0 0 10px 2px rgba(255,255,255,0.3); }
          100% { box-shadow: 0 0 30px 10px rgba(255,255,255,0.7); }
      }
      }

      @media (max-width: 768px) {
          h1 { font-size: 1.8em; }
          .subtitle { font-size: 0.9em; }
          .controls { font-size: 0.8em; }
      }
    </style>
  </head>
  <body>
    <div id="canvas-container"></div>

    <!-- Minigame Quiz Popup -->
    <div
      id="quiz-popup"
      style="
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #222;
        color: #fff;
        border-radius: 18px;
        box-shadow: 0 0 30px #000;
        z-index: 1000;
        padding: 32px 28px;
        min-width: 320px;
        max-width: 90vw;
      "
    >
      <h2 style="text-align: center; margin-bottom: 18px">
        Minigame Thi√™n VƒÉn H·ªçc
      </h2>
      <div
        id="quiz-question"
        style="font-size: 1.15em; margin-bottom: 18px"
      ></div>
      <div id="quiz-answers"></div>
      <div id="quiz-feedback" style="margin-top: 14px; font-size: 1em"></div>
      <button
        id="quiz-next-btn"
        style="
          margin-top: 18px;
          padding: 8px 22px;
          border-radius: 8px;
          background: #ffd700;
          color: #222;
          font-weight: 600;
          border: none;
          cursor: pointer;
          display: none;
        "
      >
        C√¢u ti·∫øp theo
      </button>
      <button
        id="quiz-close-btn"
        style="
          margin-top: 18px;
          padding: 8px 22px;
          border-radius: 8px;
          background: #aaa;
          color: #222;
          font-weight: 600;
          border: none;
          cursor: pointer;
        "
      >
        ƒê√≥ng
      </button>
    </div>
    <button
      id="open-quiz-btn"
      style="
        position: fixed;
        bottom: 40px;
        right: 40px;
        z-index: 900;
        background: #ffd700;
        color: #222;
        font-weight: 600;
        border: none;
        border-radius: 50px;
        padding: 16px 28px;
        font-size: 1.1em;
        box-shadow: 0 0 18px #222;
        cursor: pointer;
      "
    >
      Minigame Thi√™n VƒÉn
    </button>

    <div class="info">
      <h1>H·ªÜ M·∫∂T TR·ªúI 3D</h1>
      <p class="subtitle">Kh√°m ph√° v≈© tr·ª• b√≠ ·∫©n</p>
    </div>

    <div
      id="planet-info"
      style="
        display: none;
        position: absolute;
        left: 50%;
        top: 90px;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        color: #fff;
        padding: 20px 30px;
        border-radius: 16px;
        z-index: 20;
        min-width: 260px;
        text-align: left;
        box-shadow: 0 0 20px #222;
        font-size: 1.1em;
      "
    ></div>
    <!-- ƒê√£ di chuy·ªÉn khung th√¥ng tin v√†o ƒë√∫ng trong body, lo·∫°i b·ªè th·ª´a d·∫•u ƒë√≥ng -->

    <div class="controls">
      üñ±Ô∏è K√©o chu·ªôt ƒë·ªÉ xoay | üîç Scroll ƒë·ªÉ zoom
      <div id="view-controls" style="margin-top: 15px">
        <button
          id="btn-all"
          onclick="showAllPlanets()"
          class="brightness-btn"
          style="margin: 2px"
        >
          To√†n c·∫£nh
        </button>
        <button
          id="btn-sun"
          onclick="showSun()"
          class="brightness-btn"
          style="margin: 2px"
        >
          M·∫∑t Tr·ªùi
        </button>
        <button
          id="btn-0"
          onclick="showPlanet(0)"
          class="brightness-btn"
          style="margin: 2px"
        >
          Th·ªßy
        </button>
        <button
          id="btn-1"
          onclick="showPlanet(1)"
          class="brightness-btn"
          style="margin: 2px"
        >
          Kim
        </button>
        <button
          id="btn-2"
          onclick="showPlanet(2)"
          class="brightness-btn"
          style="margin: 2px"
        >
          Tr√°i ƒê·∫•t
        </button>
        <button
          id="btn-3"
          onclick="showPlanet(3)"
          class="brightness-btn"
          style="margin: 2px"
        >
          H·ªèa
        </button>
        <button
          id="btn-4"
          onclick="showPlanet(4)"
          class="brightness-btn"
          style="margin: 2px"
        >
          M·ªôc
        </button>
        <button
          id="btn-5"
          onclick="showPlanet(5)"
          class="brightness-btn"
          style="margin: 2px"
        >
          Th·ªï
        </button>
        <button
          id="btn-6"
          onclick="showPlanet(6)"
          class="brightness-btn"
          style="margin: 2px"
        >
          Thi√™n V∆∞∆°ng
        </button>
        <button
          id="btn-7"
          onclick="showPlanet(7)"
          class="brightness-btn"
          style="margin: 2px"
        >
          H·∫£i V∆∞∆°ng
        </button>
      </div>
    </div>

    <div class="brightness-control">
      <button class="brightness-btn" onclick="toggleBrightness()">üí°</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
// Hi·ªáu ·ª©ng sao bƒÉng v√† v·ªát s√°ng
let meteors = [];
let meteorTrails = [];
function spawnMeteor() {
  const meteorGeometry = new THREE.SphereGeometry(0.32, 12, 12); // to h∆°n
  const meteorMaterial = new THREE.MeshBasicMaterial({color: 0xffffff, transparent:true, opacity:0.8});
  const meteor = new THREE.Mesh(meteorGeometry, meteorMaterial);
  meteor.position.set(
    (Math.random()-0.5)*120,
    30 + Math.random()*30,
    (Math.random()-0.5)*120
  );
  // Gi·∫£m t·ªëc ƒë·ªô bay
  meteor.userData = {vx: -0.28-Math.random()*0.32, vy: -0.45-Math.random()*0.55, vz: 0.04-Math.random()*0.09, life: 0, trail: []}; // ch·∫≠m h∆°n
  scene.add(meteor);
  meteors.push(meteor);
}
let meteorInterval;
      // B·ªô c√¢u h·ªèi minigame thi√™n vƒÉn h·ªçc
      const quizQuestions = [
        {
          question: "H√†nh tinh n√†o g·∫ßn M·∫∑t Tr·ªùi nh·∫•t?",
          answers: ["a) Th·ªßy", "b) Kim", "c) Tr√°i ƒê·∫•t", "d) H·ªèa"],
          correct: 0,
        },
        {
          question: "H√†nh tinh l·ªõn nh·∫•t trong H·ªá M·∫∑t Tr·ªùi l√†?",
          answers: ["a) M·ªôc", "b) Th·ªï", "c) H·∫£i V∆∞∆°ng", "d) Tr√°i ƒê·∫•t"],
          correct: 0,
        },
        {
          question: "H√†nh tinh n√†o c√≥ v√†nh ƒëai n·ªïi b·∫≠t nh·∫•t?",
          answers: ["a) M·ªôc", "b) Th·ªï", "c) Thi√™n V∆∞∆°ng", "d) H·ªèa"],
          correct: 1,
        },
        {
          question: 'H√†nh tinh n√†o ƒë∆∞·ª£c g·ªçi l√† "H√†nh tinh ƒê·ªè"?',
          answers: ["a) H·ªèa", "b) Kim", "c) Th·ªßy", "d) Tr√°i ƒê·∫•t"],
          correct: 0,
        },
        {
          question: "M·∫∑t Tr·ªùi l√† lo·∫°i sao g√¨?",
          answers: [
            "a) Sao l√πn tr·∫Øng",
            "b) Sao l√πn v√†ng",
            "c) Sao kh·ªïng l·ªì ƒë·ªè",
            "d) Sao neutron",
          ],
          correct: 1,
        },
        {
          question: "H√†nh tinh n√†o xa M·∫∑t Tr·ªùi nh·∫•t?",
          answers: ["a) H·∫£i V∆∞∆°ng", "b) Thi√™n V∆∞∆°ng", "c) Th·ªï", "d) M·ªôc"],
          correct: 0,
        },
        {
          question: "H√†nh tinh n√†o c√≥ nhi·ªÅu v·ªá tinh t·ª± nhi√™n nh·∫•t?",
          answers: ["a) M·ªôc", "b) Th·ªï", "c) Tr√°i ƒê·∫•t", "d) H·ªèa"],
          correct: 0,
        },
        {
          question: "H√†nh tinh n√†o c√≥ kh√≠ quy·ªÉn ch·ªß y·∫øu l√† CO2?",
          answers: ["a) Kim", "b) H·ªèa", "c) M·ªôc", "d) Th·ªßy"],
          correct: 0,
        },
        {
          question: "H√†nh tinh n√†o c√≥ ng√†y d√†i h∆°n nƒÉm?",
          answers: ["a) Kim", "b) Th·ªßy", "c) H·ªèa", "d) M·ªôc"],
          correct: 0,
        },
        {
          question: "Thi√™n h√† ch·ª©a H·ªá M·∫∑t Tr·ªùi t√™n l√† g√¨?",
          answers: [
            "a) Thi√™n h√† Ti√™n N·ªØ",
            "b) Thi√™n h√† Xo·∫Øn ·ªêc",
            "c) D·∫£i Ng√¢n H√†",
            "d) Thi√™n h√† Sombrero",
          ],
          correct: 2,
        },
      ];

      let quizIndex = 0;
      let quizScore = 0;
      let quizAnswered = false;

      function showQuizQuestion() {
        const q = quizQuestions[quizIndex];
        document.getElementById("quiz-question").textContent = `C√¢u ${
          quizIndex + 1
        }: ${q.question}`;
        const answersDiv = document.getElementById("quiz-answers");
        answersDiv.innerHTML = "";
        q.answers.forEach((ans, i) => {
          const btn = document.createElement("button");
          btn.textContent = ans;
          btn.style.margin = "6px 0";
          btn.style.padding = "8px 18px";
          btn.style.borderRadius = "8px";
          btn.style.background = "#333";
          btn.style.color = "#ffd700";
          btn.style.fontWeight = "600";
          btn.style.border = "2px solid #ffd700";
          btn.style.cursor = "pointer";
          btn.onclick = () => selectQuizAnswer(i);
          btn.disabled = quizAnswered;
          answersDiv.appendChild(btn);
        });
        document.getElementById("quiz-feedback").textContent = "";
        document.getElementById("quiz-next-btn").style.display = "none";
        quizAnswered = false;
      }

      function selectQuizAnswer(idx) {
        if (quizAnswered) return;
        quizAnswered = true;
        const q = quizQuestions[quizIndex];
        const feedback = document.getElementById("quiz-feedback");
        if (idx === q.correct) {
          quizScore++;
          feedback.textContent = "‚úÖ Ch√≠nh x√°c!";
          feedback.style.color = "#00ff99";
        } else {
          feedback.textContent = `‚ùå Sai! ƒê√°p √°n ƒë√∫ng l√† ${
            q.answers[q.correct]
          }`;
          feedback.style.color = "#ff4444";
        }
        Array.from(document.getElementById("quiz-answers").children).forEach(
          (btn) => (btn.disabled = true)
        );
        document.getElementById("quiz-next-btn").style.display = "inline-block";
      }

      function nextQuizQuestion() {
        quizIndex++;
        quizAnswered = false;
        if (quizIndex < quizQuestions.length) {
          showQuizQuestion();
        } else {
          showQuizResult();
        }
      }

      function showQuizResult() {
        document.getElementById(
          "quiz-question"
        ).textContent = `Ho√†n th√†nh! B·∫°n ƒë√∫ng ${quizScore}/10 c√¢u.`;
        document.getElementById("quiz-answers").innerHTML = "";
        document.getElementById("quiz-feedback").textContent =
          quizScore >= 7
            ? "üéâ Tuy·ªát v·ªùi! B·∫°n r·∫•t am hi·ªÉu thi√™n vƒÉn h·ªçc!"
            : "üëç H√£y th·ª≠ l·∫°i ƒë·ªÉ ƒë·∫°t ƒëi·ªÉm cao h∆°n nh√©!";
        document.getElementById("quiz-next-btn").style.display = "none";
      }

      document.getElementById("open-quiz-btn").onclick = function () {
        quizIndex = 0;
        quizScore = 0;
        document.getElementById("quiz-popup").style.display = "block";
        showQuizQuestion();
      };
      document.getElementById("quiz-next-btn").onclick = nextQuizQuestion;
      document.getElementById("quiz-close-btn").onclick = function () {
        document.getElementById("quiz-popup").style.display = "none";
      };
      let scene,
        camera,
        renderer,
        planets = [];
      let mouseX = 0,
        mouseY = 0;
      let targetX = 0,
        targetY = 0;
      let ambientLight, sunLight;
      let isDarkMode = true;
      let planetGroups = [];
      // ƒê∆∞a d·ªØ li·ªáu h√†nh tinh ra ph·∫°m vi to√†n c·ª•c
      const planetData = [
        {
          name: "Th·ªßy",
          size: 0.8,
          distance: 12,
          color: 0x8c7853,
          speed: 0.008,
          age: "4.5 t·ª∑ nƒÉm",
          mass: "3.3 x 10^20",
          distanceEarth: "77 tri·ªáu km",
        },
        {
          name: "Kim",
          size: 1.5,
          distance: 18,
          color: 0xffc649,
          speed: 0.006,
          age: "4.5 t·ª∑ nƒÉm",
          mass: "4.87 x 10^21",
          distanceEarth: "41 tri·ªáu km",
        },
        {
          name: "Tr√°i ƒê·∫•t",
          size: 1.6,
          distance: 25,
          color: 0x4a90e2,
          speed: 0.005,
          age: "4.54 t·ª∑ nƒÉm",
          mass: "5.97 x 10^21",
          distanceEarth: "0 km",
        },
        {
          name: "H·ªèa",
          size: 1.2,
          distance: 32,
          color: 0xe27b58,
          speed: 0.004,
          age: "4.6 t·ª∑ nƒÉm",
          mass: "6.42 x 10^20",
          distanceEarth: "78 tri·ªáu km",
        },
        {
          name: "M·ªôc",
          size: 3.5,
          distance: 45,
          color: 0xc88b3a,
          speed: 0.003,
          age: "4.5 t·ª∑ nƒÉm",
          mass: "1.90 x 10^24",
          distanceEarth: "628 tri·ªáu km",
        },
        {
          name: "Th·ªï",
          size: 3,
          distance: 58,
          color: 0xfad5a5,
          speed: 0.002,
          age: "4.5 t·ª∑ nƒÉm",
          mass: "5.68 x 10^23",
          distanceEarth: "1.2 t·ª∑ km",
        },
        {
          name: "Thi√™n V∆∞∆°ng",
          size: 2.2,
          distance: 70,
          color: 0x4fc3f7,
          speed: 0.0015,
          age: "4.5 t·ª∑ nƒÉm",
          mass: "8.68 x 10^22",
          distanceEarth: "2.6 t·ª∑ km",
        },
        {
          name: "H·∫£i V∆∞∆°ng",
          size: 2.1,
          distance: 82,
          color: 0x4169e1,
          speed: 0.001,
          age: "4.5 t·ª∑ nƒÉm",
          mass: "1.02 x 10^23",
          distanceEarth: "4.3 t·ª∑ km",
        },
      ];

      function init() {
  // Kh·ªüi ƒë·ªông hi·ªáu ·ª©ng sao bƒÉng sau khi scene ƒë√£ t·∫°o
  meteors = [];
  if (meteorInterval) clearInterval(meteorInterval);
  meteorInterval = setInterval(spawnMeteor, 1200);
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(
          75,
          window.innerWidth / window.innerHeight,
          0.1,
          1000
        );
        camera.position.set(0, 50, 100);
        camera.lookAt(0, 0, 0);
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document
          .getElementById("canvas-container")
          .appendChild(renderer.domElement);
        // Th√™m √°nh s√°ng
        ambientLight = new THREE.AmbientLight(0x333333);
        scene.add(ambientLight);
        sunLight = new THREE.PointLight(0xffffff, 2, 300);
        sunLight.position.set(0, 0, 0);
        sunLight.castShadow = true;
        scene.add(sunLight);
        // T·∫°o m·∫∑t tr·ªùi
        const sunGeometry = new THREE.SphereGeometry(5, 32, 32);
        const sunMaterial = new THREE.MeshBasicMaterial({
          color: 0xfdb813, // v√†ng ƒë·ªìng
          emissive: 0xfdb813, // v√†ng ƒë·ªìng
          emissiveIntensity: 3, // s√°ng h∆°n r√µ r·ªát
        });
        const sun = new THREE.Mesh(sunGeometry, sunMaterial);
        scene.add(sun);
        window.sunMesh = sun;
        // Vi·ªÅn s√°ng tr·∫Øng v√†ng quanh m·∫∑t tr·ªùi
        const glowGeometry = new THREE.SphereGeometry(5.7, 32, 32); // vi·ªÅn nh·ªè h∆°n
        const glowMaterial = new THREE.MeshBasicMaterial({
          color: 0xffffee, // tr·∫Øng v√†ng nh·∫°t
          transparent: true,
          opacity: 0.32,
          blending: THREE.AdditiveBlending,
        });
        const sunGlowMesh = new THREE.Mesh(glowGeometry, glowMaterial);
        sunGlowMesh.position.copy(sun.position);
        scene.add(sunGlowMesh);
        // √Ånh s√°ng ph√°t ra t·ª´ m·∫∑t tr·ªùi
        const sunGlow = new THREE.PointLight(0xfdb813, 1.5, 200);
        sun.add(sunGlow);
        // D·ªØ li·ªáu c√°c h√†nh tinh ƒë√£ ƒë∆∞a ra ngo√†i
        // T·∫°o c√°c h√†nh tinh
        planetData.forEach((data) => {
          const planetGroup = new THREE.Group();
          // Qu·ªπ ƒë·∫°o
          const orbitGeometry = new THREE.RingGeometry(
            data.distance - 0.1,
            data.distance + 0.1,
            64
          );
          const orbitMaterial = new THREE.MeshBasicMaterial({
            color: 0x444444,
            side: THREE.DoubleSide,
            transparent: true,
            opacity: 0.3,
          });
          const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
          orbit.rotation.x = Math.PI / 2;
          scene.add(orbit);
          // H√†nh tinh
          const planetGeometry = new THREE.SphereGeometry(data.size, 32, 32);
          const planetMaterial = new THREE.MeshPhongMaterial({
            color: data.color,
            shininess: 30,
          });
          const planet = new THREE.Mesh(planetGeometry, planetMaterial);
          planet.position.x = data.distance;
          planet.castShadow = true;
          planet.receiveShadow = true;
          planetGroup.add(planet);
          scene.add(planetGroup);
          planetGroups.push(planetGroup);

          // Th√™m v√†nh ƒëai cho Sao Th·ªï
          if (data.name === "Th·ªï") {
            const ringGeometry = new THREE.RingGeometry(
              data.size * 1.5,
              data.size * 2.2,
              32
            );
            const ringMaterial = new THREE.MeshBasicMaterial({
              color: 0xfad5a5,
              side: THREE.DoubleSide,
              transparent: true,
              opacity: 0.7,
            });
            const ring = new THREE.Mesh(ringGeometry, ringMaterial);
            ring.rotation.x = Math.PI / 2;
            planet.add(ring);
          }

          planets.push({
            group: planetGroup,
            planet: planet,
            speed: data.speed,
            distance: data.distance,
            angle: Math.random() * Math.PI * 2,
          });
        });

        // T·∫°o ng√¥i sao n·ªÅn
        const starsGeometry = new THREE.BufferGeometry();
        const starsMaterial = new THREE.PointsMaterial({
          color: 0xffffff,
          size: 0.5,
        });

        const starsVertices = [];
        for (let i = 0; i < 3000; i++) {
          const x = (Math.random() - 0.5) * 500;
          const y = (Math.random() - 0.5) * 500;
          const z = (Math.random() - 0.5) * 500;
          starsVertices.push(x, y, z);
        }

        starsGeometry.setAttribute(
          "position",
          new THREE.Float32BufferAttribute(starsVertices, 3)
        );
        const stars = new THREE.Points(starsGeometry, starsMaterial);
        scene.add(stars);

        // X·ª≠ l√Ω chu·ªôt
        document.addEventListener("mousemove", onMouseMove);
        document.addEventListener("wheel", onWheel);
        window.addEventListener("resize", onWindowResize);
      }

      function onMouseMove(event) {
        mouseX = (event.clientX - window.innerWidth / 2) / 100;
        mouseY = (event.clientY - window.innerHeight / 2) / 100;
      }

      function onWheel(event) {
        camera.position.z += event.deltaY * 0.05;
        camera.position.z = Math.max(30, Math.min(150, camera.position.z));
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }

      function toggleBrightness() {
        isDarkMode = !isDarkMode;

        if (isDarkMode) {
          // Ch·∫ø ƒë·ªô t·ªëi
          renderer.setClearColor(0x000000);
          ambientLight.intensity = 0.3;
          sunLight.intensity = 2;
        } else {
          // Ch·∫ø ƒë·ªô s√°ng
          renderer.setClearColor(0x1a1a2e);
          ambientLight.intensity = 0.8;
          sunLight.intensity = 1.5;
        }
      }

      function animate() {
  // Animate meteors v√† v·ªát s√°ng
  for (let i = meteors.length-1; i >= 0; i--) {
    const m = meteors[i];
    // Di chuy·ªÉn ch·∫≠m h∆°n
    m.position.x += m.userData.vx*0.12;
    m.position.y += m.userData.vy*0.12;
    m.position.z += m.userData.vz*0.12;
    m.userData.life += 1;
    // T·∫°o v·ªát s√°ng ph√≠a sau
    if (m.userData.life % 2 === 0) {
      const trailGeo = new THREE.SphereGeometry(0.16, 8, 8); // v·ªát to h∆°n
      const trailMat = new THREE.MeshBasicMaterial({color: 0xfff700, transparent:true, opacity:0.45});
      const trail = new THREE.Mesh(trailGeo, trailMat);
      trail.position.copy(m.position);
      trail.userData = {fade: 1.0};
      scene.add(trail);
      m.userData.trail.push(trail);
    }
    // L√†m v·ªát s√°ng tan d·∫ßn
    for (let j = m.userData.trail.length-1; j >= 0; j--) {
      const t = m.userData.trail[j];
      t.userData.fade -= 0.04;
      t.material.opacity = Math.max(0, t.userData.fade * 0.45);
      if (t.userData.fade <= 0) {
        scene.remove(t);
        m.userData.trail.splice(j,1);
      }
    }
    // X√≥a meteor khi h·∫øt v√≤ng ƒë·ªùi
    if (m.userData.life > 70 || m.position.y < -10) {
      // X√≥a v·ªát c√≤n l·∫°i
      m.userData.trail.forEach(t => scene.remove(t));
      scene.remove(m);
      meteors.splice(i,1);
    }
  }
        requestAnimationFrame(animate);

        // Di chuy·ªÉn camera m∆∞·ª£t m√† theo chu·ªôt
        targetX = mouseX * 0.3;
        targetY = mouseY * 0.3;

        camera.position.x += (targetX - camera.position.x) * 0.05;
        camera.position.y += (targetY - camera.position.y + 50) * 0.05;
        camera.lookAt(0, 0, 0);

        // Xoay c√°c h√†nh tinh
        planets.forEach((data) => {
          data.angle += data.speed;
          data.group.rotation.y = data.angle;
          data.planet.rotation.y += 0.01;
        });

        renderer.render(scene, camera);
      }
      function showAllPlanets() {
        document.getElementById("planet-info").style.display = "none";
        planetGroups.forEach((g) => (g.visible = true));
        if (window.sunMesh) window.sunMesh.visible = true;
        camera.position.set(0, 50, 100);
        camera.lookAt(0, 0, 0);
        renderer.setClearColor(isDarkMode ? 0x000000 : 0x1a1a2e);
        ambientLight.color.setHex(0x333333);
        updateActiveButton("all");
      }

      function showPlanet(idx) {
        planetGroups.forEach((g) => (g.visible = false));
        if (planetGroups[idx]) planetGroups[idx].visible = true;
        if (window.sunMesh) window.sunMesh.visible = true;
        const data = planetData[idx];
        document.getElementById("planet-info").innerHTML = `<b>${
          data.name
        }</b><br>NƒÉm tu·ªïi: ${data.age}<br>Kho·∫£ng c√°ch t·ªõi M·∫∑t Tr·ªùi: ${
          data.distance * 10
        } tri·ªáu km<br>Kh·ªëi l∆∞·ª£ng: ${
          data.mass
        } t·∫•n<br>Kho·∫£ng c√°ch t·ªõi Tr√°i ƒê·∫•t: ${data.distanceEarth}`;
        document.getElementById("planet-info").style.display = "block";
        const planet = planets[idx].planet;
        const targetPos = planet.getWorldPosition(new THREE.Vector3());
        camera.position.x = targetPos.x;
        camera.position.y = targetPos.y + 5;
        camera.position.z = targetPos.z + 10;
        camera.lookAt(targetPos);
        const colorMap = [
          0x8c7853, 0xffc649, 0x4a90e2, 0xe27b58, 0xc88b3a, 0xfad5a5, 0x4fc3f7,
          0x4169e1,
        ];
        renderer.setClearColor(colorMap[idx]);
        ambientLight.color.setHex(colorMap[idx]);
        updateActiveButton(idx);
      }

      function showSun() {
        planetGroups.forEach((g) => (g.visible = false));
        if (window.sunMesh) window.sunMesh.visible = true;
        document.getElementById(
          "planet-info"
        ).innerHTML = `<b>M·∫∑t Tr·ªùi</b><br>NƒÉm tu·ªïi: 4.6 t·ª∑ nƒÉm<br>Kh·ªëi l∆∞·ª£ng: 1.989 x 10^27 t·∫•n<br>Kho·∫£ng c√°ch t·ªõi Tr√°i ƒê·∫•t: 149.6 tri·ªáu km`;
        document.getElementById("planet-info").style.display = "block";
        camera.position.set(0, 5, 15);
        camera.lookAt(0, 0, 0);
        renderer.setClearColor(0xfdb813);
        ambientLight.color.setHex(0xfdb813);
        updateActiveButton("sun");
      }

      init();
      animate();
    </script>
  </body>
</html>
